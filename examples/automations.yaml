# FileFlows Automation Examples
# Add these to your automations.yaml or automation UI

# ============================================
# NOTIFICATION AUTOMATIONS
# ============================================

# Notify when all processing is complete
- id: fileflows_processing_complete
  alias: "FileFlows - Processing Complete Notification"
  description: "Notify when all files have been processed"
  trigger:
    - platform: state
      entity_id: binary_sensor.fileflows_processing_active
      from: "on"
      to: "off"
      for:
        seconds: 30
  condition:
    - condition: state
      entity_id: sensor.fileflows_unprocessed_files
      state: "0"
  action:
    - service: notify.persistent_notification
      data:
        title: "FileFlows Processing Complete"
        message: >
          All files have been processed!
          Total saved: {{ states('sensor.fileflows_storage_saved') }} GB
          ({{ states('sensor.fileflows_storage_saved_percent') }}% reduction)

# Alert on failed files
- id: fileflows_failed_alert
  alias: "FileFlows - Failed Files Alert"
  description: "Alert when files fail processing"
  trigger:
    - platform: numeric_state
      entity_id: sensor.fileflows_files_failed
      above: 0
  action:
    - service: notify.persistent_notification
      data:
        title: "âš ï¸ FileFlows Processing Failure"
        message: >
          {{ states('sensor.fileflows_files_failed') }} file(s) have failed processing.
          Please check the FileFlows dashboard.

# Notify when queue is getting large
- id: fileflows_large_queue_alert
  alias: "FileFlows - Large Queue Alert"
  description: "Alert when queue exceeds threshold"
  trigger:
    - platform: numeric_state
      entity_id: sensor.fileflows_unprocessed_files
      above: 100
  action:
    - service: notify.persistent_notification
      data:
        title: "FileFlows Queue Alert"
        message: >
          Processing queue has {{ states('sensor.fileflows_unprocessed_files') }} files waiting.

# ============================================
# SCHEDULING AUTOMATIONS
# ============================================

# Pause during peak hours
- id: fileflows_pause_peak_hours
  alias: "FileFlows - Pause During Peak Hours"
  description: "Pause processing during peak TV/gaming hours"
  trigger:
    - platform: time
      at: "18:00:00"
  condition:
    - condition: state
      entity_id: switch.fileflows_system_active
      state: "on"
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.fileflows_system_active
    - service: notify.persistent_notification
      data:
        title: "FileFlows Paused"
        message: "Processing paused for peak hours"

# Resume after peak hours
- id: fileflows_resume_after_peak
  alias: "FileFlows - Resume After Peak Hours"
  description: "Resume processing after peak hours"
  trigger:
    - platform: time
      at: "23:00:00"
  condition:
    - condition: state
      entity_id: switch.fileflows_system_active
      state: "off"
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.fileflows_system_active
    - service: notify.persistent_notification
      data:
        title: "FileFlows Resumed"
        message: "Processing resumed after peak hours"

# Weekend full processing
- id: fileflows_weekend_processing
  alias: "FileFlows - Weekend Full Processing"
  description: "Enable all nodes on weekends"
  trigger:
    - platform: time
      at: "00:00:00"
  condition:
    - condition: time
      weekday:
        - sat
        - sun
  action:
    - service: fileflows.enable_node
      data:
        node_uid: "your-external-node-uid"  # Replace with actual UID

# ============================================
# SMART HOME INTEGRATION
# ============================================

# Pause when watching TV
- id: fileflows_pause_when_watching
  alias: "FileFlows - Pause When Watching TV"
  description: "Pause processing when media is playing"
  trigger:
    - platform: state
      entity_id: media_player.living_room_tv  # Replace with your media player
      to: "playing"
  condition:
    - condition: state
      entity_id: switch.fileflows_system_active
      state: "on"
  action:
    - service: switch.turn_off
      target:
        entity_id: switch.fileflows_system_active

# Resume when TV is off
- id: fileflows_resume_when_not_watching
  alias: "FileFlows - Resume When Not Watching"
  description: "Resume processing when media stops"
  trigger:
    - platform: state
      entity_id: media_player.living_room_tv  # Replace with your media player
      to: "off"
      for:
        minutes: 5
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.fileflows_system_active

# Reduce processing during high power usage
- id: fileflows_reduce_power_usage
  alias: "FileFlows - Reduce Processing During High Power"
  description: "Disable external nodes when power usage is high"
  trigger:
    - platform: numeric_state
      entity_id: sensor.house_power_consumption  # Replace with your power sensor
      above: 5000  # Watts
  action:
    - service: fileflows.disable_node
      data:
        node_uid: "your-external-node-uid"  # Replace with actual UID

# ============================================
# MAINTENANCE AUTOMATIONS
# ============================================

# Daily library rescan
- id: fileflows_daily_rescan
  alias: "FileFlows - Daily Library Rescan"
  description: "Rescan libraries daily at 4 AM"
  trigger:
    - platform: time
      at: "04:00:00"
  action:
    - service: fileflows.rescan_library
      data:
        library_uid: "your-movies-library-uid"  # Replace with actual UID
    - delay:
        minutes: 5
    - service: fileflows.rescan_library
      data:
        library_uid: "your-tv-library-uid"  # Replace with actual UID

# Weekly statistics summary
- id: fileflows_weekly_summary
  alias: "FileFlows - Weekly Summary"
  description: "Send weekly processing summary"
  trigger:
    - platform: time
      at: "09:00:00"
  condition:
    - condition: time
      weekday:
        - mon
  action:
    - service: notify.persistent_notification
      data:
        title: "ðŸ“Š FileFlows Weekly Summary"
        message: >
          **Processing Statistics**
          - Total Processed: {{ states('sensor.fileflows_processed_files') }} files
          - Storage Saved: {{ states('sensor.fileflows_storage_saved') }} GB
          - Savings Rate: {{ states('sensor.fileflows_storage_saved_percent') }}%
          - Failed Files: {{ states('sensor.fileflows_files_failed') }}
          - Current Queue: {{ states('sensor.fileflows_unprocessed_files') }}

# ============================================
# ERROR RECOVERY AUTOMATIONS
# ============================================

# Auto-restart on connection loss
- id: fileflows_connection_recovery
  alias: "FileFlows - Connection Recovery"
  description: "Refresh data when connection is restored"
  trigger:
    - platform: state
      entity_id: sensor.fileflows_version
      from: "unavailable"
  action:
    - delay:
        seconds: 30
    - service: button.press
      target:
        entity_id: button.fileflows_refresh_data

# Clear failed files notification daily
- id: fileflows_clear_failed_notification
  alias: "FileFlows - Clear Failed Notification Daily"
  description: "Dismiss failed files notification if resolved"
  trigger:
    - platform: state
      entity_id: binary_sensor.fileflows_has_failed_files
      to: "off"
  action:
    - service: persistent_notification.dismiss
      data:
        notification_id: "fileflows_failed_alert"
